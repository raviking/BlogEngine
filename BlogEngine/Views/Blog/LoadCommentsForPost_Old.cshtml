
@model List<BlogEngine.DTO.Comment>
<h1>Comments</h1>
@if (Model.Count() > 0)
{
    <div class="post-comments">
        @foreach (var comment in Model)
        {
            <div class="commet-content">
                <h3>@comment.Comment_Author</h3>
                <p>@comment.Comment_Content</p>
            </div>
            foreach (var reply in Model)
            {
                if (reply.Comment_Parent == comment.Comment_Id)
                {
                    <div class="reply-content" style="margin-left:40px;">
                        <h3>@reply.Comment_Author</h3>
                        <p>@reply.Comment_Content</p>
                    </div>
                }
            }
        }
    </div>
}
else
{
    <p>No Comments found for this post</p>
}
<input type="hidden" id="hdnPostId" value="@ViewBag.PostId" />

<span id="spnAddCommentSuccessDisplay" style="color:green;display:none;"></span>
<div class="comment-form">
    <h2>Fell free to comment</h2>
    <div class="form-group">
        <label class="label">Full Name</label><br />
        <input type="text" class="form-control" style="width:300px;" placeholder="Name" id="txt_comment_author_name" />
        <span id="spntxt_comment_author_name" style="color:red;"></span>
    </div>
    <div class="form-group">
        <label class="label">Email</label><br />
        <input type="email" class="form-control" style="width:300px;" placeholder="Email" id="txt_comment_author_email" />
        <span id="spntxt_comment_author_email" style="color:red;"></span>
    </div>
    <div class="form-group">
        <label class="label">Comment Content</label><br />
        <textarea id="txt_comment_content" class="form-control" rows="5" cols="50"></textarea>
        <span id="spntxt_comment_content" style="color:red;"></span>        
    </div>
    <div class="form-group">        
        <input type="button" class="btn btn-primary" onclick="javascript:AddComment();" id="submit_comment" value="submit" />
    </div>
</div>
<script src="~/Scripts/jquery-3.2.1.min.js"></script>
<script type="text/javascript">
    function AddComment()
    {
        if (validateForm()) {
            var objComment = {
                Comment_Id: 0,
                Comment_Content: $("#txt_comment_content").val(),
                Comment_Date: new Date(),
                Comment_Author: $("#txt_comment_author_name").val(),
                Comment_AuthorEmail: $("#txt_comment_author_email").val(),
                Comment_Parent: 0,
                Comment_Approved: 0,
                Comment_PostId: $("#hdnPostId").val()
            }

            $.ajax({
                url: 'Blog/SaveComment',
                method: 'POST',
                datatype: 'json',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(objComment),
                success: function (response) {
                    if (response.IsSucess == true) {
                        console.log("comment added successfully!");
                        $("#spnAddCommentSuccessDisplay").show();
                        $("#spnAddCommentSuccessDisplay").text("Comment submited for moderation");
                    }
                },
                error: function () {
                    console.log("Adding comment failed");
                }
            });
        }
    }

    function validateForm()
    {
        var re_email = /^([\w-\.]+@@([\w-]+\.)+[\w-]{2,4})?$/i;
        var phoneReg= /([0-9]{10})|(\([0-9]{3}\)\s+[0-9]{3}\-[0-9]{4})/;
        var result = true;
        if ($("#txt_comment_author_name").val().trim() == "" || $("#txt_comment_author_name").val().trim() == undefined) {
            $("#spntxt_comment_author_name").show();
            $("#spntxt_comment_author_name").text("Name Required");
            result = false;
        }
        if ($("#txt_comment_author_email").val().trim() == "" || $("#txt_comment_author_email").val().trim() == undefined) {
            $("#spntxt_comment_author_email").show();
            $("#spntxt_comment_author_email").text("Email Required");
            result = false;
        }
        //else if (!re_email.test($("#txt_comment_author_email").val()) == false) {
        //    $("#spntxt_comment_author_email").show();
        //    $("#spntxt_comment_author_email").text("Please Enter Valid Email");
        //    result = false;
        //}
        if ($("#txt_comment_content").val().trim() == "" || $("#txt_comment_content").val().trim() == undefined) {
            $("#spntxt_comment_content").show();
            $("#spntxt_comment_content").text("Minimum 50 words Required");
            result = false;
        }
        return result;
    }
</script>